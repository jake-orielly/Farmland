<!DOCTYPE html>
<html>
<head>
<style>
    .structures {
        margin-left: 25%;
        padding: 15px;
        padding-bottom: 5px;
        border:1px solid;
        display: inline-block;
    }
    
    .btn-modern {
        font-family: Helvetica;
        font-size: 14px;
        border-radius: 3px;
        border: 1px solid #888;
        padding: 10px;
        width: 246px;
        cursor: pointer;
    }
    
    button:focus {
        outline:0;
    }
    
    .header-bar {
        width: 75%;
        float:right;
        text-decoration: underline;
    }
    
    .menuItem {
        cursor: pointer;
    }
    
    .mouseover {
        position: relative;
        display: inline-block;
    }

    .mouseover .mouseoverText {
        visibility: hidden;
        background-color: black;
        display:block;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;

        /* Position the tooltip */
        position: absolute;
        z-index: 1;
    }

    .mouseover:hover .mouseoverText {
        visibility: visible;
    }
    
    .buy, .sell {
        font-family: Helvetica;
        font-size: 14px;
        border-radius: 3px;
        border: 1px solid #888;
        padding: 10px;
        width: 45px;
        cursor: pointer;
    }
    
    .buy {
        color: green;
    }
    
    .sell {
        color: red;
    }
    
    td {
        padding: 5px;
    }
    
    hr {
        margin-top:20px;
    }
</style>
<title>Page Title</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>

<div class="header-bar">
    <table>
        <tr>
            <td class="menuItem" onClick="menuButton(0)">Farm</td>
            <td class="menuItem" onClick="menuButton(1)">Store</td>
        </tr>
    </table>
</div>
    
<table>
	<tr>
    	<td>Berries: </td>
        <td style="width:30px" id="berries">0 </td>
        <td id="berriesMax">/300</td>
        <td id="berriesIncrease"> (+0/s)</td>
    </tr>
    <tr>
    	<td>Carrots: </td>
        <td style="width:30px" id="carrots">0 </td>
        <td id="carrotsMax">/100</td>
        <td id="carrotsIncrease"> (+0/s)</td>
    </tr>
    <tr>
    	<td>Wood: </td>
        <td style="width:30px" id="wood">0 </td>
        <td id="woodMax">/25</td>
        <td id="woodIncrease"> (+0/s)</td>
    </tr>
    <tr id="moneyInfo" hidden>
    	<td>Money: </td>
        <td id="money" style="width:30px">0 </td>
    </tr>
</table>
    
<div class="structures" id="structures">
    <table>
        <tr>
            <td><button class="btn-modern" onClick="gatherBerries(this)"> Gather Berries</button></td>
            <td><button class="btn-modern mouseover" id="berriesNew" onClick="structureNew('berryBush')">Berry Bush<span id="berriesHover" class="mouseoverText">Berries: 10</span></button></td>
        </tr>
        <tr>
            <td><button class="btn-modern mouseover" id="carrotsNew" onClick="structureNew('carrotPlant')">Carrot  Plant<span id="carrotsHover" class="mouseoverText">Carrots: 10</span></button>
        </tr>
    </table>
    <hr>
</div>
    
<div class="structures" id="store">
    <table>
        <tr id='berriesStore'>
        </tr>
        <tr id='carrotsStore'>
        </tr>
        <tr id='woodStore'>
        </tr>
    </table>
    <hr>
</div>
    
<script>
	var berries = {name:"berries",amount:0,max:300,price:1.5};
    var carrots = {name:"carrots",amount:0,max:100,price:3};
    var wood = {name:"wood", amount:0, max:25, price:10}
    var money = {name:"money", amount:0}
    
    var crops = [berries,carrots,wood];
    var resources = [money];
    var structures = {berryBush:{resource:berries,amount:0,output:0.5,multiplier:1.5,baseCost:10,name:"Berry Bush"},carrotPlant:{resource:carrots,amount:0,output:0.8,multiplier:1.3,baseCost:10,name:"Carrot Plant"}};
    
    var menuItems = ["structures","store"];
    var cycleTime = 200;
    var priceMultiplier = 2/3;
    
    $("#store").hide();
    $("#workshop").hide();
    for (var i = 0; i < crops.length; i++) {
        buildStoreButtons(crops[i].name);
    }
    setInterval(gameUpdate, cycleTime);
    
    function gameUpdate() {
        for (var curr in structures) {
            if (structures.hasOwnProperty(curr)) {
                structures[curr].resource.amount += production(structures[curr]) * cycleTime/1000;
            }
        }
        for (var i = 0; i < crops.length; i++) {
            if (crops[i].amount > crops[i].max)
                crops[i].amount = crops[i].max;
            updateDisplay();
        }
    }
    
    function updateDisplay() {
        var tooBig = "";
    	for (var i = 0; i < crops.length; i++) {
            document.getElementById(crops[i].name).innerHTML = round(crops[i].amount);
            document.getElementById(crops[i].name + "Max").innerHTML = "/" + round(crops[i].max);
        }
        
        for (var i = 0; i < resources.length; i++)
            document.getElementById(resources[i].name).innerHTML = round(resources[i].amount);
        
        for (var curr in structures) {
            if (structures.hasOwnProperty(curr)) {
                if (cost(structures[curr]) > crops[i].max)
                    tooBig = "*";
                if (structures[curr].amount > 0)
                    document.getElementById(structures[curr].resource.name + "New").innerHTML = structures[curr].name + "<span id='" + structures[curr].resource.name + "Hover' class='mouseoverText'>" + capitalizeFirst(structures[curr].resource.name) + ": " + round(cost(structures[curr])) +"</span>";
            }
        }
        
    }
    
    function gatherBerries(given) {
    	if (berries.amount+1 <= berries.max)
            berries.amount++;
        $(given).prop('disabled',true);
        setTimeout(function(){$(given).prop('disabled',false)},150);
        updateDisplay();
    }
    
    function structureNew(given) {
        var item = structures[given].resource;
        
        if (cost(structures[given]) <= item.amount) {
            item.amount -= cost(structures[given]);
            structures[given].amount++;
            document.getElementById(item.name + "Increase").innerHTML = " (+" + round(production(structures[given])) + "/s)";
            updateDisplay();
        }
    }
    
    function round(given) {
    	var num = given + "";
        for (var i = 0; i < num.length; i++) {
        	if (num[i] == ".")
            	num = num.substring(0,i+2);
        }
        return num;
    }
    
    function production(given) {
        return given.amount*given.output;
    }
    
    function menuButton(given) {
        for (var i = 0; i < menuItems.length; i++) {
            if (i != given)
                $("#" + menuItems[i]).hide();
            else
                $("#" + menuItems[i]).show();
        }
    }
    
    function buy(given,quantity = 1) {
        if (quantity == -1) {
            var max = money.amount/(given.price*priceMultiplier*2);
            buy(given,Math.floor(max));
        }
        else {
            if (money.amount >= (given.price*priceMultiplier*2*quantity)) {
                given.amount += quantity;
                money.amount -= (given.price * priceMultiplier*2)*quantity;
            }
        }
    }
    
    function sell(given,quantity = 1) {
        if (quantity == -1) {
            sell(given, given.amount);
        }
        else {
            if (given.amount >= quantity) {
                if (money.amount == 0)
                    $("#moneyInfo").show();
                given.amount -= quantity;
                money.amount += (given.price * priceMultiplier)*quantity;
            }
        }
    }
    
    function cost(given) {
        return given.baseCost * Math.pow(given.multiplier,given.amount);
    }
    
    function capitalizeFirst(given) {
        return given.charAt(0).toUpperCase() + given.slice(1);
    }
    
    function buildStoreButtons(given) { //creates the HTML for all the buttons for 1 item in the store
        var result = "";
        result += "<td>" + capitalizeFirst(given) + "</td>";
        result += "<td><button class='buy' onClick = buy(" + given + ")>Buy</button></td>";
        result += "<td><button class='buy' onClick = buy(" + given + ",5)>x5</button></td>";
        result += "<td><button class='buy' onClick = buy(" + given + ",25)>x25</button></td>";
        result += "<td><button class='buy' onClick = buy(" + given + ",'-1')>All</button></td>";
        result += "<td><button class='sell' onClick = sell(" + given + ")>Sell</button></td>";
        result += "<td><button class='sell' onClick = sell(" + given + ",5)>x5</button></td>"; 
        result += "<td><button class='sell' onClick = sell(" + given + ",25)>x25</button></td>";
        result += "<td><button class='sell' onClick = sell(" + given + ",'-1')>All</button></td>"; 
        document.getElementById(given+"Store").innerHTML = result;
    }
</script>


</body>
</html>
